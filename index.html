<!DOCTYPE html><html lang="it"><head><meta charset="UTF-8"><title>Mini Gioco Glow</title><style>*{box-sizing:border-box;user-select:none}body{margin:0;background:radial-gradient(circle at top,#222,#000);color:#fff;font-family:Arial;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}#lobby{text-align:center;background:#000a;padding:30px 40px;border-radius:12px;box-shadow:0 0 25px #0f03}h1{text-shadow:0 0 10px #0f0}.btn{width:220px;padding:14px;margin:8px 0;font-size:18px;border:none;border-radius:999px;cursor:pointer;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;box-shadow:0 0 15px #4caf50}.btn.secondary{background:#333}.skinItem{margin:6px 0;padding:6px;background:#fff1;border-radius:6px}.skinBtn{margin-left:10px;padding:4px 10px;border:none;border-radius:6px;background:#333;color:#fff;cursor:pointer}.equippedTag{color:#0f0;font-weight:bold;margin-left:10px;text-shadow:0 0 5px #0f0}#gameWrapper{display:none;flex-direction:column;align-items:center;width:100vw;height:100vh;padding-top:20px}#game{position:relative;width:400px;height:500px;background:#111;border-radius:16px;border:2px solid #444;overflow:hidden;box-shadow:0 0 25px #0f03}#player{position:absolute;bottom:10px;left:180px;width:40px;height:40px;border-radius:8px}#flash{position:absolute;inset:0;background:radial-gradient(circle,rgba(255,0,0,.7),transparent);opacity:0;transition:.15s}#flash.active{opacity:1}.falling{position:absolute;top:-40px;width:30px;height:30px;background:linear-gradient(135deg,#f44336,#ff7961);border-radius:6px;box-shadow:0 0 15px #f44336}#gameOver{position:absolute;inset:0;background:#000c;display:none;align-items:center;justify-content:center;flex-direction:column;color:#fff}#moveBar{width:300px;height:20px;background:#333;border-radius:10px;margin-top:15px;cursor:pointer;box-shadow:0 0 10px #0f0}</style></head><body>

<div id="lobby"><h1>MINI GIOCO GLOW</h1>
<button class="btn" onclick="playClick();startGame()">GIOCA</button>
<button class="btn secondary" onclick="toggleSettings()">IMPOSTAZIONI</button>
<button class="btn secondary" onclick="toggleSkins()">SKIN</button>

<div id="settingsLobby" style="display:none">
<label>Volume</label><input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="1">
<label>Luminosit√†</label><input id="brightnessSlider" type="range" min="0.3" max="1.5" step="0.01" value="1">
</div>

<div id="skinsLobby" style="display:none">
<h3>Skin</h3>
<div id="skinsCoins">Monete: 0</div>
<div id="noMoney" style="color:red;display:none;margin-top:5px">Monete insufficienti!</div>

<div class="skinItem">üå± Verde 50
<button class="skinBtn" onclick="buySkin(0)">Compra</button>
<button class="skinBtn" onclick="equipSkin(0)">Equipaggia</button>
</div>

<div class="skinItem">üîµ Blu 150
<button class="skinBtn" onclick="buySkin(1)">Compra</button>
<button class="skinBtn" onclick="equipSkin(1)">Equipaggia</button>
</div>

<div class="skinItem">üî• Rossa 350
<button class="skinBtn" onclick="buySkin(2)">Compra</button>
<button class="skinBtn" onclick="equipSkin(2)">Equipaggia</button>
</div>

<div class="skinItem">‚ö° Gialla 700
<button class="skinBtn" onclick="buySkin(3)">Compra</button>
<button class="skinBtn" onclick="equipSkin(3)">Equipaggia</button>
</div>

<div class="skinItem">üíé Azzurra 1500
<button class="skinBtn" onclick="buySkin(4)">Compra</button>
<button class="skinBtn" onclick="equipSkin(4)">Equipaggia</button>
</div>

</div></div>

<div id="gameWrapper">
<button onclick="backToLobby()" style="position:absolute;left:20px;top:20px">‚Üê LOBBY</button>
<div id="game">
<div id="player"></div>
<div id="flash"></div>
<div id="gameOver"><div id="gameOverText"></div><button onclick="initGame()">Ricomincia</button></div>
</div>
<div id="score">Punteggio: 0 | Miss: 0/5</div>
<div id="coins">Monete: 0</div>

<!-- ‚≠ê BARRA DI MOVIMENTO -->
<div id="moveBar"></div>

</div>

<script>
let audioCtx=null,globalVolume=1;
function ensureAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)}
function playClick(){ensureAudio();let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type="square";o.frequency.value=600;g.gain.value=.2*globalVolume;o.connect(g);g.connect(audioCtx.destination);o.start();o.stop(audioCtx.currentTime+.06)}
function playBuy(){ensureAudio();let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type="triangle";o.frequency.value=900;g.gain.value=.25*globalVolume;o.connect(g);g.connect(audioCtx.destination);o.start();o.stop(audioCtx.currentTime+.1)}

let coins=0,ownedSkins=[true,false,false,false,false],equippedSkin=0;
const skinStyles=[
"background:#4caf50;box-shadow:0 0 15px #4caf50;",
"background:#2196f3;box-shadow:0 0 15px #2196f3;",
"background:#ff5722;box-shadow:0 0 15px #ff5722;",
"background:#ffeb3b;box-shadow:0 0 15px #ffeb3b;",
"background:#00e5ff;box-shadow:0 0 15px #00e5ff;"
];
const skinPrices=[50,150,350,700,1500];

function updateSkinCoins(){
document.getElementById("skinsCoins").textContent="Monete: "+coins;
document.getElementById("coins").textContent="Monete: "+coins;
}

function updateSkinButtons(){
const items=document.querySelectorAll(".skinItem");
items.forEach((item,i)=>{
const buy=item.querySelector(".skinBtn:nth-child(2)");
const eq=item.querySelector(".skinBtn:nth-child(3)");

if(ownedSkins[i]){
buy.style.display="none";
if(equippedSkin===i){
eq.textContent="Equipaggiata";
eq.disabled=true;
eq.classList.add("equippedTag");
}else{
eq.textContent="Equipaggia";
eq.disabled=false;
eq.classList.remove("equippedTag");
}
}else{
buy.style.display="inline-block";
eq.textContent="Equipaggia";
eq.disabled=true;
eq.classList.remove("equippedTag");
}
});
}

function buySkin(id){
if(ownedSkins[id])return;
if(coins<skinPrices[id]){
let m=document.getElementById("noMoney");
m.style.display="block";setTimeout(()=>m.style.display="none",800);
return;
}
coins-=skinPrices[id];
ownedSkins[id]=true;
playBuy();
updateSkinCoins();
updateSkinButtons();
}

function equipSkin(id){
if(!ownedSkins[id])return;
equippedSkin=id;
applySkin();
updateSkinButtons();
}

function applySkin(){
player.setAttribute("style",skinStyles[equippedSkin]+"left:"+playerX+"px;bottom:10px;width:40px;height:40px;border-radius:8px;");
}

function toggleSettings(){let s=document.getElementById("settingsLobby");s.style.display=s.style.display=="none"?"block":"none"}
function toggleSkins(){let s=document.getElementById("skinsLobby");s.style.display=s.style.display=="none"?"block":"none";updateSkinCoins();updateSkinButtons()}

function startGame(){lobby.style.display="none";gameWrapper.style.display="flex";initGame()}
function backToLobby(){gameWrapper.style.display="none";lobby.style.display="block";cancelAnimationFrame(animId)}

volumeSlider.oninput=()=>globalVolume=parseFloat(volumeSlider.value);
brightnessSlider.oninput=()=>document.body.style.filter=`brightness(${brightnessSlider.value})`;

const game=document.getElementById("game"),player=document.getElementById("player"),scoreEl=document.getElementById("score"),coinsEl=document.getElementById("coins"),gameOverScreen=document.getElementById("gameOver"),gameOverText=document.getElementById("gameOverText"),flash=document.getElementById("flash");
const gameWidth=400,gameHeight=500,playerSpeed=6,fallingSpeedBase=2,spawnIntervalBase=900,maxMiss=5;

let keys={},playerX=180,score=0,miss=0,fallingItems=[],lastSpawn=0,lastTime=0,gameRunning=false,animId=null;

document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

function initGame(){
fallingItems.forEach(i=>i.el.remove());
fallingItems=[];score=0;miss=0;
coinsEl.textContent="Monete: "+coins;
scoreEl.textContent=`Punteggio: ${score} | Miss: ${miss}/5`;
playerX=180;lastSpawn=0;lastTime=0;gameRunning=true;
gameOverScreen.style.display="none";
applySkin();
animId=requestAnimationFrame(loop);
}

function spawnFalling(){
let d=document.createElement("div");
d.className="falling";
let size=30,x=Math.random()*(gameWidth-size);
d.style.left=x+"px";d.style.top="-40px";
game.appendChild(d);
fallingItems.push({el:d,x,y:-40,size});
}

function updatePlayer(){
if(keys["arrowleft"]||keys["a"])playerX-=playerSpeed;
if(keys["arrowright"]||keys["d"])playerX+=playerSpeed;
if(playerX<0)playerX=0;if(playerX>gameWidth-40)playerX=gameWidth-40;
applySkin();
}

function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
return ax<bx+bw&&ax+aw>bx&&ay<by+bh&&ay+ah>by;
}

function flashRed(){flash.classList.add("active");setTimeout(()=>flash.classList.remove("active"),150)}

function updateFalling(delta){
let speed=fallingSpeedBase*(1+score/20);if(speed>10)speed=10;
for(let i=fallingItems.length-1;i>=0;i--){
let it=fallingItems[i];
it.y+=speed*(delta/16.67);
it.el.style.top=it.y+"px";
let px=playerX,py=gameHeight-50;
if(rectsOverlap(px,py,40,40,it.x,it.y,it.size,it.size)){
score++;coins++;
scoreEl.textContent=`Punteggio: ${score} | Miss: ${miss}/5`;
coinsEl.textContent="Monete: "+coins;
it.el.remove();fallingItems.splice(i,1);continue;
}
if(it.y>gameHeight){
miss++;flashRed();
scoreEl.textContent=`Punteggio: ${score} | Miss: ${miss}/5`;
it.el.remove();fallingItems.splice(i,1);
if(miss>=5)endGame();
}
}
}

function endGame(){
gameRunning=false;
gameOverText.textContent=`Game Over! Punteggio: ${score}`;
gameOverScreen.style.display="flex";
}

function loop(t){
if(!gameRunning)return;
if(!lastTime)lastTime=t;
let delta=t-lastTime;lastTime=t;
updatePlayer();updateFalling(delta);
if(t-lastSpawn>spawnIntervalBase*(0.9-Math.min(score,20)/200)){
spawnFalling();lastSpawn=t;
}
animId=requestAnimationFrame(loop);
}

/* ‚≠ê MOVIMENTO CON LA BARRA */
let dragging=false;
moveBar.addEventListener("mousedown",()=>dragging=true);
document.addEventListener("mouseup",()=>dragging=false);
document.addEventListener("mousemove",e=>{
if(!dragging)return;
const rect=game.getBoundingClientRect();
let x=e.clientX-rect.left;
if(x<0)x=0;
if(x>gameWidth-40)x=gameWidth-40;
playerX=x;
applySkin();
});
</script>
</body></html>
